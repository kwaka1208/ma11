<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="UTF-8">
		<title>Pepper Action</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
		<script src="websocket.js"></script>
		<!-- script src="/libs/qimessaging/1.0/qimessaging.js"></script -->
		<script>
			var debug = true;
			/**
				WebSocketレスポンス受信時
			*/
//			Connect("ws://localhost", onReceive);
			function onReceive(evt) {
				poke(evt.data);
			}

			/*
				メッセージ処理
			*/
			function poke(data) {
				var len = data.length;
				for (i = 0; i < len; i++) {
					if( data[i].Action == "Say") {
						saytext(data[i].Txt);
					} else {
						someAction(data[i].Action);
					}
				}
			}

//			var session = new QiSession();
			function fetchServer() {
				$.ajax({
					url: "pepper.json",
					dataType: "json",
					cache: false,
					success: function(data){
						poke(data);
					},
					error: function(data){
						$("#output").append("読み込み失敗<br />");
					}
				});
			}
			// しゃべられる
			function saytext(text){
				if (text == "") return;
				if (debug) {
					$("#output").append("ここで、Pepperが" + text + "と話します。<br />");
				}else {
//					session.service("ALMemory").done(function (ALMemory) {
//					ALMemory.raiseEvent("PepperQiMessaging/fromtablet", text);
//					});
				}
			}

			// 動き
			function someAction(action){
				if (debug) {
					$("#output").append("ここで、Pepperが" + action + "の動きをします。<br />");
				}else {
//					session.service("ALMemory").done(function (ALMemory) {
//					ALMemory.raiseEvent("PepperQiAction/fromtablet",action);
//					});
				}
			}
			fetchServer();
//			setInterval(fetchServer, 1000);	// 1秒間隔でサーバーをチェック

		</script>
	</head>
	<body>
		<div id="output">
		</div>
	</body>
</html>
